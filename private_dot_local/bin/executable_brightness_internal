#!/usr/bin/sh

usage() {
    echo "Usage: $0 [--minus/plus]"
    echo ""
    echo "Options:"
    echo "  --minus       减少屏幕亮度"
    echo "  --plus        增加屏幕亮度"
    exit 1
}

# intel_backlight 不是固定的，要根据实际调整
actual="$(cat /sys/class/backlight/intel_backlight/actual_brightness)"
max="$(cat /sys/class/backlight/intel_backlight/max_brightness)"
min=$(echo "$max * 0.05" | bc -l)

for arg in "$@"; do
    case "$arg" in
        --minus)
            actual=$(echo "$actual - $max * 0.05" | bc -l)
            ;;
        --plus)
            actual=$(echo "$actual + $max * 0.05" | bc -l)
            ;;
        --help|-h)
            usage
            ;;
        *)
            echo "错误: 不支持的参数 '$arg'"
            usage
            ;;
    esac
done

if (( $(echo "$actual > $max" | bc -l) ))
then
    actual=$max
elif (( $(echo "$actual < $min" | bc -l) ))
then
    actual=$min
fi

# 取整
actual=$(echo "($actual + 0.5)/1" | bc)
echo $actual | sudo tee /sys/class/backlight/intel_backlight/brightness > /dev/null
kill -RTMIN+1 $(cat ~/.cache/pidofbar)
